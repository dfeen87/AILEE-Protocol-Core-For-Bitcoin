# AILEE-Core Secrets Configuration
# This file shows the structure for secrets configuration
# DO NOT commit actual secrets to version control

# Bitcoin RPC Configuration
bitcoin_rpc:
  # Primary Bitcoin RPC endpoint
  primary:
    url: "https://localhost:8332"
    # Use environment variables or secrets manager for credentials
    # DO NOT hardcode credentials here
    username: "${BITCOIN_RPC_USER}"
    password: "${BITCOIN_RPC_PASSWORD}"
    use_tls: true
    tls_verify: true
    # Optional: Path to CA certificate for TLS verification
    ca_cert_path: "/etc/ailee/certs/bitcoin-ca.pem"
  
  # Failover endpoints (optional)
  failover:
    - url: "https://bitcoin-backup-1.example.com:8332"
      username: "${BITCOIN_RPC_USER_BACKUP1}"
      password: "${BITCOIN_RPC_PASSWORD_BACKUP1}"
      use_tls: true
      tls_verify: true
    - url: "https://bitcoin-backup-2.example.com:8332"
      username: "${BITCOIN_RPC_USER_BACKUP2}"
      password: "${BITCOIN_RPC_PASSWORD_BACKUP2}"
      use_tls: true
      tls_verify: true
  
  # Connection pool settings
  connection_pool:
    max_connections: 10
    connection_timeout_ms: 5000
    request_timeout_ms: 30000
    max_retries: 3
    retry_backoff_ms: 1000

# Federation Signer Configuration
federation:
  # Quorum settings
  quorum:
    total_signers: 15
    required_signatures: 10
  
  # Signer key management
  # CRITICAL: Use HSM or secure key storage in production
  signers:
    # Example signer configuration
    - id: "signer-01"
      # Use environment variable or secrets manager
      private_key_ref: "${FEDERATION_SIGNER_01_KEY}"
      # Or reference a secure key store
      key_store_type: "hsm"  # Options: hsm, vault, file, env
      key_store_path: "pkcs11://token=ailee-signer-01"
    
    # Additional signers...
    # In production, each signer should have:
    # - Hardware Security Module (HSM) backing
    # - Multi-party computation (MPC) for key generation
    # - Geographic distribution
    # - Independent operators

# API Authentication
api:
  # JWT Configuration
  jwt:
    # CRITICAL: Generate strong secret with: python -c "import secrets; print(secrets.token_urlsafe(64))"
    secret: "${AILEE_JWT_SECRET}"
    algorithm: "HS256"
    expiration_minutes: 60
  
  # API Keys for service-to-service auth
  api_keys:
    # Reference from secrets manager, not hardcoded
    - name: "monitoring_service"
      key_hash: "${MONITORING_API_KEY_HASH}"
    - name: "backup_service"
      key_hash: "${BACKUP_API_KEY_HASH}"

# TLS/SSL Configuration
tls:
  # API Server TLS
  api_server:
    enabled: true
    cert_path: "/etc/ailee/certs/server.crt"
    key_path: "/etc/ailee/certs/server.key"
    ca_path: "/etc/ailee/certs/ca.crt"
    # Minimum TLS version
    min_version: "TLSv1.3"
    # Cipher suites (strong ciphers only)
    ciphers:
      - "TLS_AES_256_GCM_SHA384"
      - "TLS_CHACHA20_POLY1305_SHA256"
      - "TLS_AES_128_GCM_SHA256"
  
  # P2P Network TLS
  p2p:
    enabled: true
    cert_path: "/etc/ailee/certs/p2p.crt"
    key_path: "/etc/ailee/certs/p2p.key"
    peer_verification: true

# Secrets Manager Integration (Optional but Recommended)
secrets_manager:
  # Options: hashicorp_vault, aws_secrets_manager, azure_key_vault, gcp_secret_manager
  provider: "hashicorp_vault"
  
  # HashiCorp Vault configuration
  vault:
    address: "${VAULT_ADDR}"
    token: "${VAULT_TOKEN}"  # Use AppRole or Kubernetes auth in production
    namespace: "ailee"
    secret_path: "secret/ailee/production"
    # Enable auto-renewal
    auto_renew: true
    renew_interval_seconds: 3600
  
  # AWS Secrets Manager configuration
  aws:
    region: "${AWS_REGION}"
    secret_name: "ailee/production/secrets"
    # Use IAM role instead of access keys
    use_iam_role: true
  
  # Azure Key Vault configuration
  azure:
    vault_url: "${AZURE_VAULT_URL}"
    # Use managed identity instead of client secrets
    use_managed_identity: true

# Encryption at Rest
encryption:
  # Private key encryption
  private_keys:
    enabled: true
    # Key encryption key (KEK) from secrets manager
    kek_ref: "${PRIVATE_KEY_ENCRYPTION_KEY}"
    algorithm: "AES-256-GCM"
  
  # Database encryption
  database:
    enabled: true
    encryption_key_ref: "${DATABASE_ENCRYPTION_KEY}"

# Audit and Compliance
audit:
  # Security event logging
  enabled: true
  log_path: "/var/log/ailee/security-audit.log"
  # Log all authentication attempts
  log_auth_events: true
  # Log all configuration changes
  log_config_changes: true
  # Log all key operations
  log_key_operations: true
  # Retention period (days)
  retention_days: 90

# Production Security Checklist
# Before deploying to production, verify:
# ✓ All secrets stored in secrets manager, not in config files
# ✓ TLS enabled for all external connections
# ✓ Federation keys stored in HSM
# ✓ Audit logging enabled and monitored
# ✓ Regular key rotation schedule established
# ✓ Backup and recovery procedures tested
# ✓ Rate limiting configured and tested
# ✓ Security monitoring and alerting configured
